/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package practicafinalsmm;

import com.sun.prism.BasicStroke;
import sm.MCG.iu.Dibujo;
import java.awt.Color;
import java.awt.Point;
import java.awt.color.ColorSpace;
import java.awt.event.ActionEvent;
import java.awt.geom.AffineTransform;
import java.awt.image.AffineTransformOp;
import java.awt.image.BandCombineOp;
import java.awt.image.BufferedImage;
import java.awt.image.ByteLookupTable;
import java.awt.image.ColorConvertOp;
import java.awt.image.ColorModel;
import java.awt.image.ConvolveOp;
import java.awt.image.Kernel;
import java.awt.image.LookupOp;
import java.awt.image.LookupTable;
import java.awt.image.RescaleOp;
import java.awt.image.WritableRaster;
import java.io.File;
import static java.lang.Math.abs;
import static java.lang.Math.sin;
import static java.lang.Math.toRadians;
import static java.lang.Thread.sleep;
import javax.imageio.ImageIO;
import javax.media.control.FrameGrabbingControl;
import javax.sound.sampled.LineEvent;
import javax.sound.sampled.LineListener;
import javax.swing.JColorChooser;
import javax.swing.JFileChooser;
import javax.swing.JOptionPane;
import sm.MCG.graficos.MContorno;
import sm.MCG.graficos.MFiguras;
import sm.MCG.graficos.MRelleno;
import sm.MCG.imagen.MlookupOp;
import sm.MCG.imagen.PropioCC;
import sm.MCG.imagen.PropioPP;
import sm.MCG.imagen.SepiaOp;
import sm.MCG.imagen.UmbralizacionOp;
import sm.MCG.imagen.utilities;
import sm.MCG.iu.MyCellRenderer;
import sm.image.EqualizationOp;
import sm.image.KernelProducer;
import sm.image.LookupTableProducer;
import sm.image.TintOp;
import sm.sound.SMClipPlayer;
import sm.sound.SMSoundRecorder;

/**
 *
 * @author mati
 */
public class VentanaFinal extends javax.swing.JFrame {

    /**
     * Creates new form Ventana7
     */
    public VentanaFinal() {
        initComponents();
        util= new utilities();
        contador.setText("00:00");
        externa = null ;
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        barraHerramientasSuperior = new javax.swing.JToolBar();
        nuevo_doc = new javax.swing.JButton();
        abrir_doc = new javax.swing.JButton();
        guardar_doc = new javax.swing.JButton();
        linea = new javax.swing.JToggleButton();
        rectangulo = new javax.swing.JToggleButton();
        ovalo = new javax.swing.JToggleButton();
        curva = new javax.swing.JToggleButton();
        trazoLibre = new javax.swing.JToggleButton();
        areaLuna = new javax.swing.JToggleButton();
        mover = new javax.swing.JToggleButton();
        taerFrente = new javax.swing.JToggleButton();
        enviarFondo = new javax.swing.JToggleButton();
        traerDelante = new javax.swing.JToggleButton();
        enviarAtras = new javax.swing.JToggleButton();
        relleno = new javax.swing.JToggleButton();
        alisar = new javax.swing.JToggleButton();
        playSonido = new javax.swing.JButton();
        stopSonido = new javax.swing.JButton();
        listaReproduccion = new javax.swing.JComboBox<>();
        grabarSonidoBarrHerram = new javax.swing.JToggleButton();
        contador = new javax.swing.JLabel();
        camara = new javax.swing.JButton();
        captura = new javax.swing.JButton();
        jToolBar4 = new javax.swing.JToolBar();
        jToolBar5 = new javax.swing.JToolBar();
        Color c[]= {Color.BLACK, Color.RED,Color.BLUE,Color.WHITE,Color.YELLOW,Color.GREEN};
        coloresTrazo = new javax.swing.JComboBox<>(c);
        colorContorno = new javax.swing.JButton();
        Color d[]= {Color.BLACK, Color.RED,Color.BLUE,Color.WHITE,Color.YELLOW,Color.GREEN};
        coloresRelleno = new javax.swing.JComboBox<>(d);
        colorRelleno = new javax.swing.JButton();
        degradadoActivar = new javax.swing.JToggleButton();
        degradadoOpcion = new javax.swing.JComboBox<>();
        colorDegradado = new javax.swing.JButton();
        grosor = new javax.swing.JSpinner();
        discontinuidad = new javax.swing.JComboBox<>();
        SliderPatronDiscontinuidad = new javax.swing.JSlider();
        transparencia = new javax.swing.JToggleButton();
        gradoTransparencia = new javax.swing.JSlider();
        jPanel2 = new javax.swing.JPanel();
        jPanel4 = new javax.swing.JPanel();
        etiqueta_barra_menu = new javax.swing.JLabel();
        jPanel5 = new javax.swing.JPanel();
        jToolBar3 = new javax.swing.JToolBar();
        jPanel11 = new javax.swing.JPanel();
        Filtros = new javax.swing.JComboBox<>();
        jPanel6 = new javax.swing.JPanel();
        deslizador_brillo = new javax.swing.JSlider();
        jPanel12 = new javax.swing.JPanel();
        contraste = new javax.swing.JButton();
        iluminacion = new javax.swing.JButton();
        oscurecer = new javax.swing.JButton();
        binariza = new javax.swing.JButton();
        posteriza = new javax.swing.JButton();
        Negativo = new javax.swing.JButton();
        jPanel13 = new javax.swing.JPanel();
        sepia = new javax.swing.JButton();
        propiapp = new javax.swing.JButton();
        tintado = new javax.swing.JButton();
        ecualizador = new javax.swing.JButton();
        propiocc = new javax.swing.JButton();
        seno = new javax.swing.JButton();
        jPanel7 = new javax.swing.JPanel();
        extraccion_bandas = new javax.swing.JButton();
        espacios_de_color = new javax.swing.JComboBox<>();
        jPanel15 = new javax.swing.JPanel();
        aumentar_Escala = new javax.swing.JButton();
        disminuir_Escala = new javax.swing.JButton();
        jPanel14 = new javax.swing.JPanel();
        slider_rotacion = new javax.swing.JSlider();
        rotacion90 = new javax.swing.JButton();
        rotacion180 = new javax.swing.JButton();
        rotacion270 = new javax.swing.JButton();
        jPanel10 = new javax.swing.JPanel();
        Slider_umbralizacion = new javax.swing.JSlider();
        jPanel9 = new javax.swing.JPanel();
        jPanel3 = new javax.swing.JPanel();
        jDesktopPane1 = new javax.swing.JDesktopPane();
        jMenuBar1 = new javax.swing.JMenuBar();
        archivo = new javax.swing.JMenu();
        nuevo = new javax.swing.JMenuItem();
        abrir = new javax.swing.JMenuItem();
        guardar = new javax.swing.JMenuItem();
        duplicar = new javax.swing.JMenuItem();
        grabaAudio = new javax.swing.JMenuItem();
        ayuda = new javax.swing.JMenuItem();
        edicion = new javax.swing.JMenu();
        barra_estado = new javax.swing.JCheckBoxMenuItem();
        barra_formas = new javax.swing.JCheckBoxMenuItem();
        barra_atributos = new javax.swing.JCheckBoxMenuItem();
        imagen = new javax.swing.JMenu();
        resacaleOP = new javax.swing.JMenuItem();
        convolveOP = new javax.swing.JMenuItem();
        affine_transfor_Op = new javax.swing.JMenuItem();
        lookup_Op = new javax.swing.JMenuItem();
        band_conbine_Op = new javax.swing.JMenuItem();
        color_convert_op = new javax.swing.JMenuItem();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setPreferredSize(new java.awt.Dimension(1530, 720));

        jPanel1.setBackground(new java.awt.Color(153, 153, 153));
        jPanel1.setLayout(new java.awt.BorderLayout());

        barraHerramientasSuperior.setRollover(true);

        nuevo_doc.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconos/nuevo.png"))); // NOI18N
        nuevo_doc.setToolTipText("nuevo");
        nuevo_doc.setFocusable(false);
        nuevo_doc.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        nuevo_doc.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        nuevo_doc.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                nuevo_docActionPerformed(evt);
            }
        });
        barraHerramientasSuperior.add(nuevo_doc);

        abrir_doc.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconos/abrir.png"))); // NOI18N
        abrir_doc.setToolTipText("abrir");
        abrir_doc.setFocusable(false);
        abrir_doc.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        abrir_doc.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        abrir_doc.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                abrir_docActionPerformed(evt);
            }
        });
        barraHerramientasSuperior.add(abrir_doc);

        guardar_doc.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconos/guardar.png"))); // NOI18N
        guardar_doc.setToolTipText("guardar");
        guardar_doc.setFocusable(false);
        guardar_doc.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        guardar_doc.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        guardar_doc.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                guardar_docActionPerformed(evt);
            }
        });
        barraHerramientasSuperior.add(guardar_doc);

        linea.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconos/linea.png"))); // NOI18N
        linea.setToolTipText("linea");
        linea.setFocusable(false);
        linea.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        linea.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        linea.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                lineaActionPerformed(evt);
            }
        });
        barraHerramientasSuperior.add(linea);

        rectangulo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconos/rectangulo.png"))); // NOI18N
        rectangulo.setToolTipText("rectangulo");
        rectangulo.setFocusable(false);
        rectangulo.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        rectangulo.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        rectangulo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                rectanguloActionPerformed(evt);
            }
        });
        barraHerramientasSuperior.add(rectangulo);

        ovalo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconos/elipse.png"))); // NOI18N
        ovalo.setToolTipText("elipse");
        ovalo.setFocusable(false);
        ovalo.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        ovalo.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        ovalo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                ovaloActionPerformed(evt);
            }
        });
        barraHerramientasSuperior.add(ovalo);

        curva.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconos/curva.png"))); // NOI18N
        curva.setToolTipText("curva");
        curva.setFocusable(false);
        curva.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        curva.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        curva.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                curvaActionPerformed(evt);
            }
        });
        barraHerramientasSuperior.add(curva);

        trazoLibre.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconos/Lapiz.gif"))); // NOI18N
        trazoLibre.setToolTipText("trazo libre");
        trazoLibre.setFocusable(false);
        trazoLibre.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        trazoLibre.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        trazoLibre.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                trazoLibreActionPerformed(evt);
            }
        });
        barraHerramientasSuperior.add(trazoLibre);

        areaLuna.setText("AreaLuna");
        areaLuna.setToolTipText("clipPropio");
        areaLuna.setFocusable(false);
        areaLuna.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        areaLuna.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        areaLuna.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                areaLunaActionPerformed(evt);
            }
        });
        barraHerramientasSuperior.add(areaLuna);

        mover.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconos/seleccion.png"))); // NOI18N
        mover.setToolTipText("editar");
        mover.setFocusable(false);
        mover.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        mover.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        mover.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                moverActionPerformed(evt);
            }
        });
        barraHerramientasSuperior.add(mover);

        taerFrente.setText("Traer Frente");
        taerFrente.setBorder(javax.swing.BorderFactory.createEtchedBorder(new java.awt.Color(0, 0, 0), new java.awt.Color(0, 0, 0)));
        taerFrente.setFocusable(false);
        taerFrente.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        taerFrente.setMargin(new java.awt.Insets(4, 14, 4, 14));
        taerFrente.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        taerFrente.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                taerFrenteActionPerformed(evt);
            }
        });
        barraHerramientasSuperior.add(taerFrente);

        enviarFondo.setText("Enviar Fondo");
        enviarFondo.setBorder(javax.swing.BorderFactory.createEtchedBorder(new java.awt.Color(0, 0, 0), new java.awt.Color(0, 0, 0)));
        enviarFondo.setFocusable(false);
        enviarFondo.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        enviarFondo.setMargin(new java.awt.Insets(4, 14, 4, 14));
        enviarFondo.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        enviarFondo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                enviarFondoActionPerformed(evt);
            }
        });
        barraHerramientasSuperior.add(enviarFondo);

        traerDelante.setText("Traer Delante ");
        traerDelante.setBorder(javax.swing.BorderFactory.createEtchedBorder(new java.awt.Color(0, 0, 0), new java.awt.Color(0, 0, 0)));
        traerDelante.setFocusable(false);
        traerDelante.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        traerDelante.setMargin(new java.awt.Insets(4, 14, 4, 14));
        traerDelante.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        traerDelante.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                traerDelanteActionPerformed(evt);
            }
        });
        barraHerramientasSuperior.add(traerDelante);

        enviarAtras.setText("Enviar Atras");
        enviarAtras.setBorder(javax.swing.BorderFactory.createEtchedBorder(new java.awt.Color(0, 0, 0), new java.awt.Color(0, 0, 0)));
        enviarAtras.setFocusable(false);
        enviarAtras.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        enviarAtras.setMargin(new java.awt.Insets(4, 14, 4, 14));
        enviarAtras.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        enviarAtras.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                enviarAtrasActionPerformed(evt);
            }
        });
        barraHerramientasSuperior.add(enviarAtras);

        relleno.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconos/rellenar.png"))); // NOI18N
        relleno.setToolTipText("relleno");
        relleno.setFocusable(false);
        relleno.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        relleno.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        relleno.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                rellenoActionPerformed(evt);
            }
        });
        barraHerramientasSuperior.add(relleno);

        alisar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconos/alisar.png"))); // NOI18N
        alisar.setToolTipText("alisar");
        alisar.setFocusable(false);
        alisar.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        alisar.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        alisar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                alisarActionPerformed(evt);
            }
        });
        barraHerramientasSuperior.add(alisar);

        playSonido.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconosPracticaSonido/play24x24.png"))); // NOI18N
        playSonido.setToolTipText("play");
        playSonido.setFocusable(false);
        playSonido.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        playSonido.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        playSonido.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                playSonidoActionPerformed(evt);
            }
        });
        barraHerramientasSuperior.add(playSonido);

        stopSonido.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconosPracticaSonido/stop24x24.png"))); // NOI18N
        stopSonido.setToolTipText("stop");
        stopSonido.setFocusable(false);
        stopSonido.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        stopSonido.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        stopSonido.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                stopSonidoActionPerformed(evt);
            }
        });
        barraHerramientasSuperior.add(stopSonido);

        listaReproduccion.setModel(new javax.swing.DefaultComboBoxModel<>(new File[] {}));
        listaReproduccion.setToolTipText("lista de reproduccion audio");
        listaReproduccion.setMaximumSize(new java.awt.Dimension(143, 22));
        listaReproduccion.setMinimumSize(new java.awt.Dimension(143, 22));
        listaReproduccion.setPreferredSize(new java.awt.Dimension(143, 22));
        barraHerramientasSuperior.add(listaReproduccion);

        grabarSonidoBarrHerram.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconosPracticaSonido/record24x24.png"))); // NOI18N
        grabarSonidoBarrHerram.setToolTipText("grabar audio");
        grabarSonidoBarrHerram.setFocusable(false);
        grabarSonidoBarrHerram.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        grabarSonidoBarrHerram.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        grabarSonidoBarrHerram.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                grabarSonidoBarrHerramActionPerformed(evt);
            }
        });
        barraHerramientasSuperior.add(grabarSonidoBarrHerram);

        contador.setToolTipText("temporizador audio");
        contador.setBorder(new javax.swing.border.SoftBevelBorder(javax.swing.border.BevelBorder.RAISED, null, null, null, new java.awt.Color(255, 255, 0)));
        contador.setMaximumSize(new java.awt.Dimension(43, 18));
        contador.setMinimumSize(new java.awt.Dimension(43, 18));
        contador.setOpaque(true);
        contador.setPreferredSize(new java.awt.Dimension(43, 18));
        barraHerramientasSuperior.add(contador);

        camara.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconosPracticaVideo/Camara.png"))); // NOI18N
        camara.setToolTipText("camara");
        camara.setFocusable(false);
        camara.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        camara.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        camara.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                camaraActionPerformed(evt);
            }
        });
        barraHerramientasSuperior.add(camara);

        captura.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconosPracticaVideo/Capturar.png"))); // NOI18N
        captura.setToolTipText("captura imagen del video");
        captura.setFocusable(false);
        captura.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        captura.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        captura.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                capturaActionPerformed(evt);
            }
        });
        barraHerramientasSuperior.add(captura);

        jToolBar4.setRollover(true);
        barraHerramientasSuperior.add(jToolBar4);

        jPanel1.add(barraHerramientasSuperior, java.awt.BorderLayout.CENTER);

        jToolBar5.setRollover(true);

        coloresTrazo.setRenderer(new MyCellRenderer());
        coloresTrazo.setModel(new javax.swing.DefaultComboBoxModel<>(c));
        coloresTrazo.setToolTipText("colores");
        coloresTrazo.setMaximumSize(new java.awt.Dimension(73, 42));
        coloresTrazo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                coloresTrazoActionPerformed(evt);
            }
        });
        jToolBar5.add(coloresTrazo);

        colorContorno.setText("ColorContorno");
        colorContorno.setToolTipText("paleta de colores para el contorno");
        colorContorno.setFocusable(false);
        colorContorno.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        colorContorno.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        colorContorno.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                colorContornoActionPerformed(evt);
            }
        });
        jToolBar5.add(colorContorno);

        coloresRelleno.setRenderer(new MyCellRenderer());
        coloresRelleno.setModel(new javax.swing.DefaultComboBoxModel<>(d));
        coloresRelleno.setToolTipText("colores");
        coloresRelleno.setMaximumSize(new java.awt.Dimension(73, 42));
        coloresRelleno.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                coloresRellenoActionPerformed(evt);
            }
        });
        jToolBar5.add(coloresRelleno);

        colorRelleno.setText("ColorRelleno");
        colorRelleno.setToolTipText("paleta de colores para el relleno");
        colorRelleno.setFocusable(false);
        colorRelleno.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        colorRelleno.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        colorRelleno.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                colorRellenoActionPerformed(evt);
            }
        });
        jToolBar5.add(colorRelleno);

        degradadoActivar.setText("Activar Degradado");
        degradadoActivar.setFocusable(false);
        degradadoActivar.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        degradadoActivar.setMargin(new java.awt.Insets(3, 14, 3, 14));
        degradadoActivar.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        degradadoActivar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                degradadoActivarActionPerformed(evt);
            }
        });
        jToolBar5.add(degradadoActivar);

        degradadoOpcion.setMaximumRowCount(3);
        degradadoOpcion.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Degradado Horizontal", "Degradado Vertical", "degradado Inclinado" }));
        degradadoOpcion.setMaximumSize(new java.awt.Dimension(150, 22));
        degradadoOpcion.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                degradadoOpcionActionPerformed(evt);
            }
        });
        jToolBar5.add(degradadoOpcion);

        colorDegradado.setBackground(new java.awt.Color(204, 204, 204));
        colorDegradado.setText("2º Color Degradado");
        colorDegradado.setFocusable(false);
        colorDegradado.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        colorDegradado.setMaximumSize(new java.awt.Dimension(130, 23));
        colorDegradado.setMinimumSize(new java.awt.Dimension(130, 23));
        colorDegradado.setPreferredSize(new java.awt.Dimension(130, 23));
        colorDegradado.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        colorDegradado.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                colorDegradadoActionPerformed(evt);
            }
        });
        jToolBar5.add(colorDegradado);

        grosor.setModel(new javax.swing.SpinnerNumberModel(2, 1, null, 1));
        grosor.setToolTipText("grosor");
        grosor.setMaximumSize(new java.awt.Dimension(50, 33));
        grosor.setMinimumSize(new java.awt.Dimension(50, 33));
        grosor.setPreferredSize(new java.awt.Dimension(50, 33));
        grosor.setValue(2);
        grosor.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                grosorStateChanged(evt);
            }
        });
        jToolBar5.add(grosor);

        discontinuidad.setMaximumRowCount(4);
        discontinuidad.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "punteadas a tope", "punteadas redonda", "punteadas cuadrada", "continua" }));
        discontinuidad.setToolTipText("tipo de continuidad del trazo");
        discontinuidad.setMaximumSize(new java.awt.Dimension(143, 22));
        discontinuidad.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                discontinuidadActionPerformed(evt);
            }
        });
        jToolBar5.add(discontinuidad);

        SliderPatronDiscontinuidad.setMaximum(50);
        SliderPatronDiscontinuidad.setMinimum(1);
        SliderPatronDiscontinuidad.setValue(15);
        SliderPatronDiscontinuidad.setMaximumSize(new java.awt.Dimension(60, 26));
        SliderPatronDiscontinuidad.setPreferredSize(new java.awt.Dimension(60, 26));
        SliderPatronDiscontinuidad.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                SliderPatronDiscontinuidadStateChanged(evt);
            }
        });
        jToolBar5.add(SliderPatronDiscontinuidad);

        transparencia.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconos/transparencia.png"))); // NOI18N
        transparencia.setToolTipText("transparencia");
        transparencia.setFocusable(false);
        transparencia.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        transparencia.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        transparencia.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                transparenciaActionPerformed(evt);
            }
        });
        jToolBar5.add(transparencia);

        gradoTransparencia.setToolTipText("slider grado transparencia");
        gradoTransparencia.setMaximumSize(new java.awt.Dimension(120, 26));
        gradoTransparencia.setMinimumSize(new java.awt.Dimension(120, 26));
        gradoTransparencia.setPreferredSize(new java.awt.Dimension(120, 26));
        gradoTransparencia.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                gradoTransparenciaStateChanged(evt);
            }
        });
        jToolBar5.add(gradoTransparencia);

        jPanel1.add(jToolBar5, java.awt.BorderLayout.NORTH);

        getContentPane().add(jPanel1, java.awt.BorderLayout.PAGE_START);

        jPanel2.setLayout(new java.awt.BorderLayout());

        jPanel4.setLayout(new javax.swing.BoxLayout(jPanel4, javax.swing.BoxLayout.LINE_AXIS));

        etiqueta_barra_menu.setText("Etiqueta de barra de menu");
        jPanel4.add(etiqueta_barra_menu);

        jPanel2.add(jPanel4, java.awt.BorderLayout.CENTER);

        jPanel5.setPreferredSize(new java.awt.Dimension(858, 125));
        jPanel5.setLayout(new javax.swing.BoxLayout(jPanel5, javax.swing.BoxLayout.LINE_AXIS));

        jToolBar3.setRollover(true);

        jPanel11.setBackground(new java.awt.Color(204, 204, 204));
        jPanel11.setBorder(javax.swing.BorderFactory.createCompoundBorder(javax.swing.BorderFactory.createTitledBorder("Filtro"), javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0))));
        jPanel11.setMaximumSize(new java.awt.Dimension(200, 125));

        Filtros.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Emborronamiento media", "Emboronamiento binomial", "Enfoque", "Relieve", "Fronteras laplaciano", "Expe" }));
        Filtros.setToolTipText("filtros");
        Filtros.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                FiltrosActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel11Layout = new javax.swing.GroupLayout(jPanel11);
        jPanel11.setLayout(jPanel11Layout);
        jPanel11Layout.setHorizontalGroup(
            jPanel11Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel11Layout.createSequentialGroup()
                .addComponent(Filtros, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE))
        );
        jPanel11Layout.setVerticalGroup(
            jPanel11Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel11Layout.createSequentialGroup()
                .addGap(26, 26, 26)
                .addComponent(Filtros, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(48, Short.MAX_VALUE))
        );

        jToolBar3.add(jPanel11);

        jPanel6.setBackground(new java.awt.Color(204, 204, 204));
        jPanel6.setBorder(javax.swing.BorderFactory.createCompoundBorder(javax.swing.BorderFactory.createTitledBorder("Brillo"), javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0))));
        jPanel6.setMaximumSize(new java.awt.Dimension(214, 125));
        jPanel6.setMinimumSize(new java.awt.Dimension(214, 65));
        jPanel6.setRequestFocusEnabled(false);

        deslizador_brillo.setMaximum(255);
        deslizador_brillo.setMinimum(-255);
        deslizador_brillo.setToolTipText("brillo");
        deslizador_brillo.setValue(0);
        deslizador_brillo.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                deslizador_brilloStateChanged(evt);
            }
        });
        deslizador_brillo.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                deslizador_brilloFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                deslizador_brilloFocusLost(evt);
            }
        });

        javax.swing.GroupLayout jPanel6Layout = new javax.swing.GroupLayout(jPanel6);
        jPanel6.setLayout(jPanel6Layout);
        jPanel6Layout.setHorizontalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel6Layout.createSequentialGroup()
                .addComponent(deslizador_brillo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE))
        );
        jPanel6Layout.setVerticalGroup(
            jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel6Layout.createSequentialGroup()
                .addGap(23, 23, 23)
                .addComponent(deslizador_brillo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(47, Short.MAX_VALUE))
        );

        jToolBar3.add(jPanel6);

        jPanel12.setBackground(new java.awt.Color(204, 204, 204));
        jPanel12.setBorder(javax.swing.BorderFactory.createCompoundBorder(javax.swing.BorderFactory.createTitledBorder("Contraste"), new javax.swing.border.MatteBorder(null)));
        jPanel12.setMaximumSize(new java.awt.Dimension(250, 125));
        jPanel12.setMinimumSize(new java.awt.Dimension(250, 125));
        jPanel12.setPreferredSize(new java.awt.Dimension(250, 125));

        contraste.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconosPractica10/contraste.png"))); // NOI18N
        contraste.setToolTipText("contraste");
        contraste.setMargin(new java.awt.Insets(1, 10, 1, 10));
        contraste.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                contrasteActionPerformed(evt);
            }
        });

        iluminacion.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconosPractica10/iluminar.png"))); // NOI18N
        iluminacion.setToolTipText("ilumina");
        iluminacion.setMargin(new java.awt.Insets(1, 10, 1, 10));
        iluminacion.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                iluminacionActionPerformed(evt);
            }
        });

        oscurecer.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconosPractica10/oscurecer.png"))); // NOI18N
        oscurecer.setToolTipText("oscurece");
        oscurecer.setMargin(new java.awt.Insets(1, 10, 1, 10));
        oscurecer.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                oscurecerActionPerformed(evt);
            }
        });

        binariza.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconos/binariza.png"))); // NOI18N
        binariza.setToolTipText("binariza");
        binariza.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                binarizaActionPerformed(evt);
            }
        });

        posteriza.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconos/posteriza.png"))); // NOI18N
        posteriza.setToolTipText("posteriza");
        posteriza.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                posterizaActionPerformed(evt);
            }
        });

        Negativo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconos/negativo.png"))); // NOI18N
        Negativo.setToolTipText("negativo");
        Negativo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                NegativoActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel12Layout = new javax.swing.GroupLayout(jPanel12);
        jPanel12.setLayout(jPanel12Layout);
        jPanel12Layout.setHorizontalGroup(
            jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel12Layout.createSequentialGroup()
                .addGroup(jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(jPanel12Layout.createSequentialGroup()
                        .addComponent(contraste)
                        .addGap(18, 18, 18)
                        .addComponent(oscurecer))
                    .addGroup(jPanel12Layout.createSequentialGroup()
                        .addComponent(iluminacion)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(posteriza, javax.swing.GroupLayout.PREFERRED_SIZE, 42, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(8, 8, 8)))
                .addGap(18, 18, 18)
                .addGroup(jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(binariza, javax.swing.GroupLayout.PREFERRED_SIZE, 42, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(Negativo, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE))
                .addContainerGap(76, Short.MAX_VALUE))
        );
        jPanel12Layout.setVerticalGroup(
            jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel12Layout.createSequentialGroup()
                .addGroup(jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(binariza, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE)
                    .addComponent(oscurecer, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(contraste, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addGap(16, 16, 16)
                .addGroup(jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(iluminacion, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(posteriza, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE)
                    .addComponent(Negativo, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE))
                .addContainerGap(36, Short.MAX_VALUE))
        );

        jToolBar3.add(jPanel12);

        jPanel13.setBackground(new java.awt.Color(204, 204, 204));
        jPanel13.setBorder(javax.swing.BorderFactory.createCompoundBorder(javax.swing.BorderFactory.createTitledBorder("f_Seno"), new javax.swing.border.MatteBorder(null)));
        jPanel13.setMaximumSize(new java.awt.Dimension(280, 125));
        jPanel13.setMinimumSize(new java.awt.Dimension(280, 125));
        jPanel13.setPreferredSize(new java.awt.Dimension(280, 125));

        sepia.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconosPractica10/sepia.png"))); // NOI18N
        sepia.setToolTipText("sepia");
        sepia.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                sepiaActionPerformed(evt);
            }
        });

        propiapp.setText("Propio pp");
        propiapp.setToolTipText("diseño propio pixel a pixel");
        propiapp.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                propiappActionPerformed(evt);
            }
        });

        tintado.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconosPractica10/tintar.png"))); // NOI18N
        tintado.setToolTipText("tintado");
        tintado.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                tintadoActionPerformed(evt);
            }
        });

        ecualizador.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconosPractica10/ecualizar.png"))); // NOI18N
        ecualizador.setToolTipText("ecualizador");
        ecualizador.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                ecualizadorActionPerformed(evt);
            }
        });

        propiocc.setText("Propio cc");
        propiocc.setToolTipText("diseño propio comp. a comp");
        propiocc.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                propioccActionPerformed(evt);
            }
        });

        seno.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconosPractica10/sinusoidal.png"))); // NOI18N
        seno.setToolTipText("seno");
        seno.setFocusable(false);
        seno.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        seno.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        seno.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                senoActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel13Layout = new javax.swing.GroupLayout(jPanel13);
        jPanel13.setLayout(jPanel13Layout);
        jPanel13Layout.setHorizontalGroup(
            jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel13Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(sepia)
                .addGap(18, 18, 18)
                .addComponent(tintado)
                .addGap(18, 18, 18)
                .addComponent(ecualizador)
                .addContainerGap(47, Short.MAX_VALUE))
            .addGroup(jPanel13Layout.createSequentialGroup()
                .addComponent(seno)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(propiapp)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(propiocc)
                .addContainerGap())
        );
        jPanel13Layout.setVerticalGroup(
            jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel13Layout.createSequentialGroup()
                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(propiapp)
                        .addComponent(propiocc))
                    .addComponent(seno))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 17, Short.MAX_VALUE)
                .addGroup(jPanel13Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(ecualizador)
                    .addComponent(tintado)
                    .addComponent(sepia))
                .addContainerGap())
        );

        jToolBar3.add(jPanel13);

        jPanel7.setBackground(new java.awt.Color(204, 204, 204));
        jPanel7.setBorder(javax.swing.BorderFactory.createCompoundBorder(javax.swing.BorderFactory.createTitledBorder("Color"), new javax.swing.border.MatteBorder(null)));
        jPanel7.setMaximumSize(new java.awt.Dimension(150, 125));
        jPanel7.setMinimumSize(new java.awt.Dimension(150, 125));
        jPanel7.setPreferredSize(new java.awt.Dimension(150, 125));

        extraccion_bandas.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconosPractica10/bandas.png"))); // NOI18N
        extraccion_bandas.setToolTipText("bandas");
        extraccion_bandas.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                extraccion_bandasActionPerformed(evt);
            }
        });

        espacios_de_color.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "RGB", "YCC", "GREY" }));
        espacios_de_color.setToolTipText("espacios de color");
        espacios_de_color.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                espacios_de_colorActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel7Layout = new javax.swing.GroupLayout(jPanel7);
        jPanel7.setLayout(jPanel7Layout);
        jPanel7Layout.setHorizontalGroup(
            jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel7Layout.createSequentialGroup()
                .addComponent(extraccion_bandas)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 10, Short.MAX_VALUE)
                .addComponent(espacios_de_color, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        jPanel7Layout.setVerticalGroup(
            jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel7Layout.createSequentialGroup()
                .addGroup(jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(espacios_de_color, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(extraccion_bandas))
                .addContainerGap(65, Short.MAX_VALUE))
        );

        jToolBar3.add(jPanel7);

        jPanel15.setBackground(new java.awt.Color(204, 204, 204));
        jPanel15.setBorder(javax.swing.BorderFactory.createCompoundBorder(javax.swing.BorderFactory.createTitledBorder("Escala"), javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0))));
        jPanel15.setMaximumSize(new java.awt.Dimension(79, 125));
        jPanel15.setMinimumSize(new java.awt.Dimension(79, 125));
        jPanel15.setPreferredSize(new java.awt.Dimension(79, 125));

        aumentar_Escala.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconosPractica10/aumentar.png"))); // NOI18N
        aumentar_Escala.setToolTipText("aumenta");
        aumentar_Escala.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                aumentar_EscalaActionPerformed(evt);
            }
        });

        disminuir_Escala.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconosPractica10/disminuir.png"))); // NOI18N
        disminuir_Escala.setToolTipText("disminulle");
        disminuir_Escala.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                disminuir_EscalaActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel15Layout = new javax.swing.GroupLayout(jPanel15);
        jPanel15.setLayout(jPanel15Layout);
        jPanel15Layout.setHorizontalGroup(
            jPanel15Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel15Layout.createSequentialGroup()
                .addGroup(jPanel15Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(disminuir_Escala)
                    .addComponent(aumentar_Escala))
                .addGap(0, 16, Short.MAX_VALUE))
        );
        jPanel15Layout.setVerticalGroup(
            jPanel15Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel15Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(aumentar_Escala)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(disminuir_Escala)
                .addContainerGap(22, Short.MAX_VALUE))
        );

        jToolBar3.add(jPanel15);

        jPanel14.setBackground(new java.awt.Color(204, 204, 204));
        jPanel14.setBorder(javax.swing.BorderFactory.createCompoundBorder(javax.swing.BorderFactory.createTitledBorder("Rotación"), new javax.swing.border.MatteBorder(null)));
        jPanel14.setMaximumSize(new java.awt.Dimension(230, 125));
        jPanel14.setMinimumSize(new java.awt.Dimension(230, 125));
        jPanel14.setPreferredSize(new java.awt.Dimension(230, 125));

        slider_rotacion.setMaximum(360);
        slider_rotacion.setToolTipText("rotacion");
        slider_rotacion.setValue(0);
        slider_rotacion.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                slider_rotacionStateChanged(evt);
            }
        });
        slider_rotacion.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                slider_rotacionFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                slider_rotacionFocusLost(evt);
            }
        });

        rotacion90.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconosPractica10/rotacion90.png"))); // NOI18N
        rotacion90.setToolTipText("rotacion 90");
        rotacion90.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                rotacion90ActionPerformed(evt);
            }
        });

        rotacion180.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconosPractica10/rotacion180.png"))); // NOI18N
        rotacion180.setToolTipText("rotacion 180");
        rotacion180.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                rotacion180ActionPerformed(evt);
            }
        });

        rotacion270.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconosPractica10/rotacion270.png"))); // NOI18N
        rotacion270.setToolTipText("rotacion 270");
        rotacion270.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                rotacion270ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel14Layout = new javax.swing.GroupLayout(jPanel14);
        jPanel14.setLayout(jPanel14Layout);
        jPanel14Layout.setHorizontalGroup(
            jPanel14Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel14Layout.createSequentialGroup()
                .addComponent(slider_rotacion, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 16, Short.MAX_VALUE))
            .addGroup(jPanel14Layout.createSequentialGroup()
                .addGap(18, 18, 18)
                .addComponent(rotacion90)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(rotacion180)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(rotacion270)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel14Layout.setVerticalGroup(
            jPanel14Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel14Layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(slider_rotacion, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel14Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(rotacion90)
                    .addComponent(rotacion180)
                    .addComponent(rotacion270))
                .addGap(21, 21, 21))
        );

        jToolBar3.add(jPanel14);

        jPanel10.setBackground(new java.awt.Color(204, 204, 204));
        jPanel10.setBorder(javax.swing.BorderFactory.createCompoundBorder(javax.swing.BorderFactory.createTitledBorder("Umbralizacion"), javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0))));
        jPanel10.setMaximumSize(new java.awt.Dimension(238, 125));

        Slider_umbralizacion.setMaximum(255);
        Slider_umbralizacion.setToolTipText("umbralización");
        Slider_umbralizacion.setValue(128);
        Slider_umbralizacion.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                Slider_umbralizacionStateChanged(evt);
            }
        });
        Slider_umbralizacion.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                Slider_umbralizacionFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                Slider_umbralizacionFocusLost(evt);
            }
        });

        javax.swing.GroupLayout jPanel10Layout = new javax.swing.GroupLayout(jPanel10);
        jPanel10.setLayout(jPanel10Layout);
        jPanel10Layout.setHorizontalGroup(
            jPanel10Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel10Layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(Slider_umbralizacion, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        jPanel10Layout.setVerticalGroup(
            jPanel10Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel10Layout.createSequentialGroup()
                .addContainerGap(29, Short.MAX_VALUE)
                .addComponent(Slider_umbralizacion, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(41, 41, 41))
        );

        jToolBar3.add(jPanel10);

        javax.swing.GroupLayout jPanel9Layout = new javax.swing.GroupLayout(jPanel9);
        jPanel9.setLayout(jPanel9Layout);
        jPanel9Layout.setHorizontalGroup(
            jPanel9Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 0, Short.MAX_VALUE)
        );
        jPanel9Layout.setVerticalGroup(
            jPanel9Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 123, Short.MAX_VALUE)
        );

        jToolBar3.add(jPanel9);

        jPanel5.add(jToolBar3);

        jPanel2.add(jPanel5, java.awt.BorderLayout.PAGE_START);

        getContentPane().add(jPanel2, java.awt.BorderLayout.PAGE_END);

        javax.swing.GroupLayout jDesktopPane1Layout = new javax.swing.GroupLayout(jDesktopPane1);
        jDesktopPane1.setLayout(jDesktopPane1Layout);
        jDesktopPane1Layout.setHorizontalGroup(
            jDesktopPane1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 1755, Short.MAX_VALUE)
        );
        jDesktopPane1Layout.setVerticalGroup(
            jDesktopPane1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 393, Short.MAX_VALUE)
        );

        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jDesktopPane1)
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jDesktopPane1)
        );

        getContentPane().add(jPanel3, java.awt.BorderLayout.CENTER);

        archivo.setText("Archivo");
        archivo.setToolTipText("archivo");

        nuevo.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_N, java.awt.event.InputEvent.CTRL_MASK));
        nuevo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconos/nuevo.png"))); // NOI18N
        nuevo.setText("Nuevo");
        nuevo.setToolTipText("nuevo");
        nuevo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                nuevoActionPerformed(evt);
            }
        });
        archivo.add(nuevo);

        abrir.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_A, java.awt.event.InputEvent.CTRL_MASK));
        abrir.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconos/abrir.png"))); // NOI18N
        abrir.setText("Abrir");
        abrir.setToolTipText("abrir");
        abrir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                abrirActionPerformed(evt);
            }
        });
        archivo.add(abrir);

        guardar.setAccelerator(javax.swing.KeyStroke.getKeyStroke(java.awt.event.KeyEvent.VK_S, java.awt.event.InputEvent.CTRL_MASK));
        guardar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconos/guardar.png"))); // NOI18N
        guardar.setText("Guardar");
        guardar.setToolTipText("guardar");
        guardar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                guardarActionPerformed(evt);
            }
        });
        archivo.add(guardar);

        duplicar.setText("Duplicar");
        duplicar.setToolTipText("duplicar");
        duplicar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                duplicarActionPerformed(evt);
            }
        });
        archivo.add(duplicar);

        grabaAudio.setIcon(new javax.swing.ImageIcon(getClass().getResource("/practica10/iconosPracticaSonido/record24x24.png"))); // NOI18N
        grabaAudio.setText("Grabar audio");
        grabaAudio.setToolTipText("grabar audio");
        grabaAudio.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                grabaAudioActionPerformed(evt);
            }
        });
        archivo.add(grabaAudio);

        ayuda.setText("Ayuda");
        ayuda.setToolTipText("ayuda");
        ayuda.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                ayudaActionPerformed(evt);
            }
        });
        archivo.add(ayuda);

        jMenuBar1.add(archivo);

        edicion.setText("Edición");
        edicion.setToolTipText("edicion");

        barra_estado.setSelected(true);
        barra_estado.setText("Ver barra de estado");
        barra_estado.setToolTipText("ver barra de estado");
        barra_estado.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                barra_estadoActionPerformed(evt);
            }
        });
        edicion.add(barra_estado);

        barra_formas.setSelected(true);
        barra_formas.setText("Ver barra de formas");
        barra_formas.setToolTipText("ver barra de formas");
        barra_formas.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                barra_formasActionPerformed(evt);
            }
        });
        edicion.add(barra_formas);

        barra_atributos.setSelected(true);
        barra_atributos.setText("Ver barra de atributos");
        barra_atributos.setToolTipText("ver barra de atributos");
        barra_atributos.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                barra_atributosActionPerformed(evt);
            }
        });
        edicion.add(barra_atributos);

        jMenuBar1.add(edicion);

        imagen.setText("Imagen");
        imagen.setToolTipText("imagen");

        resacaleOP.setText("ResacaleOP");
        resacaleOP.setToolTipText("rescaleOp");
        resacaleOP.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                resacaleOPActionPerformed(evt);
            }
        });
        imagen.add(resacaleOP);

        convolveOP.setText("ConvolveOP");
        convolveOP.setToolTipText("ConvolveOP");
        convolveOP.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                convolveOPActionPerformed(evt);
            }
        });
        imagen.add(convolveOP);

        affine_transfor_Op.setText("Affine TransformOp");
        affine_transfor_Op.setToolTipText("Affine TransformOp");
        affine_transfor_Op.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                affine_transfor_OpActionPerformed(evt);
            }
        });
        imagen.add(affine_transfor_Op);

        lookup_Op.setText("LookupOp");
        lookup_Op.setToolTipText("LookupOp");
        lookup_Op.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                lookup_OpActionPerformed(evt);
            }
        });
        imagen.add(lookup_Op);

        band_conbine_Op.setText("BandCombineOp");
        band_conbine_Op.setToolTipText("BandCombineOp");
        band_conbine_Op.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                band_conbine_OpActionPerformed(evt);
            }
        });
        imagen.add(band_conbine_Op);

        color_convert_op.setText("ColorConvertOp");
        color_convert_op.setToolTipText("ColorConvertOp");
        color_convert_op.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                color_convert_opActionPerformed(evt);
            }
        });
        imagen.add(color_convert_op);

        jMenuBar1.add(imagen);

        setJMenuBar(jMenuBar1);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void nuevoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_nuevoActionPerformed
        externa = new VentanaInternaImagen("nuevo", this);
        jDesktopPane1.add(externa);
        
        //Eleccion del tamaño de la imagen, si no se elige tamaño será preferedsize
        int ancho = this.getPreferredSize().width; //[1530, 
        int alto = this.getPreferredSize().height; // 720]
        String txtancho = JOptionPane.showInputDialog("Elige el ancho del lienzo ");
        if(txtancho!=null){
            if(!txtancho.equals("")){
                ancho = Integer.parseInt(txtancho);
            }
            String txtalto = JOptionPane.showInputDialog(" Elige el alto del lienzo ");
            if(txtalto!=null){
                if(!txtalto.equals("")){
                    alto = Integer.parseInt(txtalto);
                }
            }
        }
        if(alto < 20 ){
            alto = 20;
        }else if(ancho < 20){
            ancho = 20;
        }else if (ancho > this.getPreferredSize().width){
            ancho = this.getPreferredSize().width;//[1530, 
        }else if (alto > this.getPreferredSize().height){
            alto = this.getPreferredSize().height;// 720]
        }
        JOptionPane.showMessageDialog(null, "Dimensiones elegidas son : \n Ancho: "+ancho + "\n Alto: "+alto);
        
        BufferedImage imgprueba = new BufferedImage(ancho, alto, BufferedImage.TYPE_INT_ARGB);
        imgprueba.getGraphics().setColor(Color.WHITE);
        imgprueba.getGraphics().fillRect(0, 0, imgprueba.getWidth(), imgprueba.getHeight());
        externa.lienzo1().setImage(imgprueba);
        
        externa.setVisible(true);
        externa.setBounds(20, 20, imgprueba.getWidth()+30, imgprueba.getHeight()+40);
    }//GEN-LAST:event_nuevoActionPerformed

    private void lineaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_lineaActionPerformed
      if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
        ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setDibujo(Dibujo.enum_linea);
        etiqueta_barra_menu.setText("Linea");
        linea.setSelected(true);
        rectangulo.setSelected(false);
        ovalo.setSelected(false);
        mover.setSelected(false);
        areaLuna.setSelected(false);
        trazoLibre.setSelected(false);
        curva.setSelected(false);
        ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setEditar(false);
      }
    }//GEN-LAST:event_lineaActionPerformed

    private void rectanguloActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_rectanguloActionPerformed
      if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
        ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setDibujo(Dibujo.enum_rectangulo);
        etiqueta_barra_menu.setText("Rectangulo");
        rectangulo.setSelected(true);
        linea.setSelected(false);
        ovalo.setSelected(false);
        mover.setSelected(false);
        areaLuna.setSelected(false);
        trazoLibre.setSelected(false);
        curva.setSelected(false);
        ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setEditar(false);
      }
    }//GEN-LAST:event_rectanguloActionPerformed

    private void ovaloActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_ovaloActionPerformed
       if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
        ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setDibujo(Dibujo.enum_elipse);
        etiqueta_barra_menu.setText("Ovalo");
        ovalo.setSelected(true);
        linea.setSelected(false);
        rectangulo.setSelected(false);
        mover.setSelected(false);
        areaLuna.setSelected(false);
        trazoLibre.setSelected(false);
        curva.setSelected(false);
        ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setEditar(false);
      }
    }//GEN-LAST:event_ovaloActionPerformed

    private void barra_estadoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_barra_estadoActionPerformed
        if(this.barra_estado.isSelected()){
            this.etiqueta_barra_menu.setVisible(true);
        }else{
            this.etiqueta_barra_menu.setVisible(false);
        }
    }//GEN-LAST:event_barra_estadoActionPerformed

    private void abrirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_abrirActionPerformed
        JFileChooser dlg = new JFileChooser();                    
        int resp = dlg.showOpenDialog(this);
        if( resp == JFileChooser.APPROVE_OPTION) {
            try{
                File f = dlg.getSelectedFile();
                int i = f.getName().lastIndexOf('.');// indice que nos indica donde empieza la extension
                String sub = f.getName();
                sub.substring(i); //aqui tendriamos la extension
                if(".gif".equals(sub.substring(i)) || ".jpg".equals(sub.substring(i)) || ".png".equals(sub.substring(i)) || ".jpeg".equals(sub.substring(i))){ //graficos
                    BufferedImage img = ImageIO.read(f);
                    VentanaInternaImagen vi = new VentanaInternaImagen("Nueva imagen", this);
                    vi.lienzo1().setImage(img);
                    this.jDesktopPane1.add(vi);
                    vi.setTitle(f.getName());
                    vi.setVisible(true);
                    vi.setBounds(20, 20, img.getWidth()+30, img.getHeight()+40);
                }else if(".wav".equals(sub.substring(i)) || ".aiff".equals(sub.substring(i)) || ".au".equals(sub.substring(i))){//audio
                    File nf = new File( dlg.getSelectedFile().getAbsolutePath() ){
                        @Override
                        public String toString(){
                            return this.getName();
                        }
                    };
                    this.listaReproduccion.addItem(nf);
                    this.listaReproduccion.setSelectedItem(nf);
                }else if(".mpg".equals(sub.substring(i))||".mp4".equals(sub.substring(i)) || ".avi".equals(sub.substring(i)) || ".mp3".equals(sub.substring(i))){//video .mpg=clip de pelicula .mp4  .avi   .mp3
                    VentanaInternaJMFPlayer vi  =  VentanaInternaJMFPlayer.getInstance(f);
                    this.f = dlg.getSelectedFile();
                    //VentanaInternaVLCPlayer vi = VentanaInternaVLCPlayer.getInstance(f);
                    this.jDesktopPane1.add(vi);
                    vi.setTitle(f.getName());
                    vi.setVisible(true);
                }else{
                    JOptionPane.showMessageDialog(this, " Extension no reconocida ");
                    abrirActionPerformed(evt);
                }
            }catch(Exception ex){
            System.err.println("Error al leer la imagen");
            System.err.println(ex.getMessage());
            }
        }
    }//GEN-LAST:event_abrirActionPerformed

    private void guardarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_guardarActionPerformed
      if( this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
        VentanaInternaSM vi = (VentanaInternaSM)this.jDesktopPane1.getSelectedFrame();
        if(vi.getImagen() != null){
            JFileChooser dlg = new JFileChooser();
            int resp = dlg.showDialog(this, " Guardar ");
            if( resp == JFileChooser.APPROVE_OPTION) {
               //File f = dlg.getSelectedFile();
               try {
                BufferedImage img = ((VentanaInternaImagen)vi).lienzo1().getImage(true);
                    if (img != null) {
                        
                    File f = dlg.getSelectedFile();
                    
                    int i = f.getName().lastIndexOf('.');// indice que nos indica donde empieza la extension
                    String sub = f.getName();
                    sub.substring(i); //aqui tendriamos la extension
                    
                    if(!"png".equals(sub) && img.getColorModel().hasAlpha()){ // si es diferente a png y tenemos alpha, tenemos que guardar como png, avisar
                        ImageIO.write(img, "png", f);
                    }else if(!"".equals(sub.substring(i)) && extensionesImagen(sub.substring(i))){ //metodo que compruebe que es alguno de los posibles casos
                        ImageIO.write(img, sub.substring(i), f);
                        vi.setTitle(f.getName());
                    }else{
                        ImageIO.write(img, "jpg", f);
                        vi.setTitle(f.getName());
                        JOptionPane.showMessageDialog(this," Lo has guardado con una extension no correcta " + f.getName());
                    }
                }
                }catch (Exception ex) {
                    System.err.println("Error al guardar la imagen"+ex);
                }
            }
        }
      }
    }//GEN-LAST:event_guardarActionPerformed

    public boolean extensionesImagen(String sub){
        boolean salida = false ;
        if("gif".equals(sub) || "jpg".equals(sub) || "png".equals(sub) || "jpeg".equals(sub)){ 
            salida = true;
        }
        return salida;
    }
    
    private void barra_formasActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_barra_formasActionPerformed
        if(this.barra_formas.isSelected()){
            this.jPanel1.setVisible(true);
        }else{
            this.jPanel1.setVisible(false);
        }
    }//GEN-LAST:event_barra_formasActionPerformed

    private void barra_atributosActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_barra_atributosActionPerformed
        if(this.barra_atributos.isSelected()){
            this.jPanel5.setVisible(true);
        }else{
            this.jPanel5.setVisible(false);
        }
    }//GEN-LAST:event_barra_atributosActionPerformed

    private void grosorStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_grosorStateChanged
      if(this.jDesktopPane1.getSelectedFrame()instanceof VentanaInternaImagen){  
        ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setGrosor((int) this.grosor.getValue());
      }
    }//GEN-LAST:event_grosorStateChanged

    private void resacaleOPActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_resacaleOPActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi != null) {
            BufferedImage imgSource = vi.getImagen();
            if(imgSource!=null){
                try{
                    RescaleOp rop = new RescaleOp(1.0F, 100.0F, null);
                    rop.filter(imgSource, imgSource);
                    ((VentanaInternaImagen)vi).lienzo1().repaint();
                } catch(IllegalArgumentException e){
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_resacaleOPActionPerformed

    private void convolveOPActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_convolveOPActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi != null) {
            BufferedImage imgSource = vi.getImagen();
            if(imgSource!=null){
                try{
                    Kernel k = KernelProducer.createKernel(KernelProducer.TYPE_MEDIA_3x3);
                    ConvolveOp cop = new ConvolveOp(k,ConvolveOp.EDGE_NO_OP,null);
                    BufferedImage imgout = cop.filter(imgSource, null);
                    ((VentanaInternaImagen)vi).lienzo1().setImage(imgout);
                    ((VentanaInternaImagen)vi).lienzo1().repaint();
                } catch(IllegalArgumentException e){
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_convolveOPActionPerformed

    private void deslizador_brilloFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_deslizador_brilloFocusGained
        VentanaInternaSM vi = (VentanaInternaSM)(this.jDesktopPane1.getSelectedFrame());
        if(vi!=null){
            if(vi.getImagen()!=null){
            ColorModel cm = vi.getImagen().getColorModel(); //clonar
            WritableRaster raster = vi.getImagen().copyData(null);//clonar cre un raster copia del anterior
            boolean alfaPre = vi.getImagen().isAlphaPremultiplied(); //clonar
            imgSourc = new BufferedImage(cm,raster,alfaPre,null);
            }
        }
    }//GEN-LAST:event_deslizador_brilloFocusGained

    private void deslizador_brilloFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_deslizador_brilloFocusLost
       imgSourc = null;
       this.deslizador_brillo.setValue(0);
    }//GEN-LAST:event_deslizador_brilloFocusLost

    private void deslizador_brilloStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_deslizador_brilloStateChanged
         VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi != null) {
            
            if(imgSourc!=null){
                try{
                    RescaleOp rop ;
                    float offsets[];
                    float scaleofset[];
                    int a = imgSourc.getColorModel().getNumColorComponents(); //numero de componentes sin contar alpha
                    int b = imgSourc.getColorModel().getNumComponents(); // numero de componentes contando alpha
                    
                    if(imgSourc.getColorModel().hasAlpha()){ 
                        offsets = new float[b];
                        scaleofset = new float[b];
                        for(int i= 0 ; i < b-1 ; i++){
                            offsets[i] = deslizador_brillo.getValue();
                            scaleofset[i] = 1.0F ;
                        }
                        offsets[b-1] = 1.0F;
                        scaleofset[b-1] = 1.0F ;
                    }else{
                        offsets = new float[a];
                        scaleofset = new float[a];
                        for(int i= 0 ; i < a ; i++){
                            offsets[i] = deslizador_brillo.getValue();
                            scaleofset[i] = 1.0F ;
                        }
                    }
                                  
                    rop = new RescaleOp(scaleofset, offsets, null);
                    rop.filter(imgSourc, vi.getImagen());
                    ((VentanaInternaImagen)vi).lienzo1().repaint();
                } catch(IllegalArgumentException e){
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_deslizador_brilloStateChanged

    private void FiltrosActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_FiltrosActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi != null) {
            BufferedImage imgSource = vi.getImagen();
            if(imgSource!=null){
                try{
                        Kernel k = null;
                    switch(this.Filtros.getSelectedIndex()){
                        case 0: // emborronamiento media
                            k = KernelProducer.createKernel(KernelProducer.TYPE_MEDIA_3x3);
                            break;
                        case 1: // emborronamiento binomial
                            k = KernelProducer.createKernel(KernelProducer.TYPE_BINOMIAL_3x3);
                            break;
                        case 2: // enfoque
                            k = KernelProducer.createKernel(KernelProducer.TYPE_ENFOQUE_3x3);
                            break;
                        case 3: // relieve
                            k = KernelProducer.createKernel(KernelProducer.TYPE_RELIEVE_3x3);
                            break;
                        case 4: // fronteras laplaciano
                            k = KernelProducer.createKernel(KernelProducer.TYPE_LAPLACIANA_3x3);
                            break;
                        case 5: // experimento
                            float mascara[]={0.01f,0.01f,0.01f,0.01f,0.01f,
                                            0.01f,0.1f,0.1f,0.1f,0.01f,
                                            0.01f,0.1f,0.04f,0.1f,0.01f,
                                            0.01f,0.1f,0.1f,0.1f,0.01f,
                                            0.01f,0.01f,0.01f,0.01f,0.01f};
                            k = new Kernel(5, 5, mascara);
                            break;
                    }
                    ConvolveOp cop = new ConvolveOp(k,ConvolveOp.EDGE_NO_OP,null);
                    BufferedImage imgout = cop.filter(imgSource, null);
                    ((VentanaInternaImagen)vi).lienzo1().setImage(imgout);
                    ((VentanaInternaImagen)vi).lienzo1().repaint();
                } catch(IllegalArgumentException e){
                    System.err.println(e.getLocalizedMessage());
                }
            }
        }
    }//GEN-LAST:event_FiltrosActionPerformed

    private void affine_transfor_OpActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_affine_transfor_OpActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi != null) {
            BufferedImage imgSource = vi.getImagen();
            if(imgSource!=null){
                AffineTransform at = AffineTransform.getScaleInstance(1.25,1.25);
                AffineTransformOp op;
                op = new AffineTransformOp(at,AffineTransformOp.TYPE_BILINEAR );

                BufferedImage imgdest = op.filter(imgSource, null);
                ((VentanaInternaImagen)vi).lienzo1().setImage(imgdest);
                ((VentanaInternaImagen)vi).lienzo1().repaint();
            }    
        }
    }//GEN-LAST:event_affine_transfor_OpActionPerformed

    private void lookup_OpActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_lookup_OpActionPerformed
         VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi != null) {
            BufferedImage imgSource = vi.getImagen();
            if(imgSource!=null){
                LookupTable lt;
                lt=LookupTableProducer.createLookupTable(LookupTableProducer.TYPE_SFUNCION);
                LookupOp lop = new LookupOp(lt, null);
                BufferedImage imgdest = lop.filter(imgSource, null);
                ((VentanaInternaImagen)vi).lienzo1().setImage(imgdest);
                ((VentanaInternaImagen)vi).lienzo1().repaint();
            }    
        }
    }//GEN-LAST:event_lookup_OpActionPerformed

    public LookupTable seno(float w){
        double K = 255.0;
        byte lt[] = new byte[256];
        lt[0]=0;
        for (int l=1; l<256; l++){
            lt[l] = (byte)(K*(abs(sin(toRadians(w)*((double)l)))));
        }
        ByteLookupTable slt = new ByteLookupTable(0,lt);
        return slt;
    }
    
    private void slider_rotacionStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_slider_rotacionStateChanged
        VentanaInternaSM vi = (VentanaInternaSM)(this.jDesktopPane1.getSelectedFrame());
        if(vi!=null){
            if(imgSourc!=null){
                double r = Math.toRadians(this.slider_rotacion.getValue());
                Point c = new Point(imgSourc.getWidth()/2, imgSourc.getHeight()/2);
                AffineTransform at = AffineTransform.getRotateInstance(r,c.x,c.y);
                AffineTransformOp atop;
                atop = new AffineTransformOp(at,AffineTransformOp.TYPE_BILINEAR);
                BufferedImage img = atop.filter(imgSourc, null); 
                ((VentanaInternaImagen)vi).lienzo1().setImage(img);
                ((VentanaInternaImagen)vi).lienzo1().repaint();
            }
        }
    }//GEN-LAST:event_slider_rotacionStateChanged
    private void slider_rotacionFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_slider_rotacionFocusGained
        VentanaInternaSM vi = (VentanaInternaSM)(this.jDesktopPane1.getSelectedFrame());
        if(vi!=null){
            if(vi.getImagen()!=null){
            ColorModel cm = vi.getImagen().getColorModel(); //clonar
            WritableRaster raster = vi.getImagen().copyData(null);//clonar cre un raster copia del anterior
            boolean alfaPre = vi.getImagen().isAlphaPremultiplied(); //clonar
            imgSourc = new BufferedImage(cm,raster,alfaPre,null);
            }
        }
    }//GEN-LAST:event_slider_rotacionFocusGained

    private void slider_rotacionFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_slider_rotacionFocusLost
        imgSourc = null;
        this.slider_rotacion.setValue(0);
    }//GEN-LAST:event_slider_rotacionFocusLost

    private void aumentar_EscalaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_aumentar_EscalaActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi != null) {
            try{
                BufferedImage imgSource = vi.getImagen();
                if(imgSource!=null){
                    AffineTransform at = AffineTransform.getScaleInstance(1.25, 1.25);
                    AffineTransformOp atop;
                    atop = new AffineTransformOp(at,AffineTransformOp.TYPE_BILINEAR);
                    BufferedImage imgdest=null;
                    if(imgSource.getType()==0){
                        BufferedImage img = util.filter(imgSource, null);
                         imgdest = atop.filter(img, null);
                    }else{
                         imgdest = atop.filter(imgSource, null);
                    }

                    ((VentanaInternaImagen)vi).lienzo1().setImage(imgdest);
                    ((VentanaInternaImagen)vi).lienzo1().repaint();
                }
            }catch(Exception ex){
                System.err.println("No se pudo aumentar la imagen ");
            }
        }
    }//GEN-LAST:event_aumentar_EscalaActionPerformed

    private void disminuir_EscalaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_disminuir_EscalaActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi != null) {
            try{
                BufferedImage imgSource = vi.getImagen();
                if(imgSource!=null){
                    AffineTransform at = AffineTransform.getScaleInstance(0.75, 0.75);
                    AffineTransformOp atop;
                    atop = new AffineTransformOp(at,AffineTransformOp.TYPE_BILINEAR);
                    BufferedImage imgdest=null;
                    if(imgSource.getType()==0){
                        BufferedImage img = util.filter(imgSource, null);
                         imgdest = atop.filter(img, null);
                    }else{
                         imgdest = atop.filter(imgSource, null);
                    }

                    ((VentanaInternaImagen)vi).lienzo1().setImage(imgdest);
                    ((VentanaInternaImagen)vi).lienzo1().repaint();
                }
            }catch(Exception ex){
                System.err.println("No se pudo disminuir la imagen ");
            }
        }
    }//GEN-LAST:event_disminuir_EscalaActionPerformed

    private void contrasteActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_contrasteActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi != null) {
            try{
                BufferedImage imgSource = vi.getImagen();
                if(imgSource!=null){
                    LookupTable lt;
                    lt=LookupTableProducer.createLookupTable(LookupTableProducer.TYPE_SFUNCION);
                    LookupOp lop = new LookupOp(lt, null);
                    BufferedImage imgdest = lop.filter(imgSource, null);
                    ((VentanaInternaImagen)vi).lienzo1().setImage(imgdest);
                    ((VentanaInternaImagen)vi).lienzo1().repaint();
                } 
            }catch(Exception ex){
                System.err.println("No se pudo hacer contraste en la imagen ");
            }
        }
    }//GEN-LAST:event_contrasteActionPerformed

    private void iluminacionActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_iluminacionActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi != null) {
            try{
                BufferedImage imgSource = vi.getImagen();
                if(imgSource!=null){
                    LookupTable lt;
                    lt=LookupTableProducer.createLookupTable(LookupTableProducer.TYPE_LOGARITHM);
                    LookupOp lop = new LookupOp(lt, null);
                    BufferedImage imgdest = lop.filter(imgSource, null);
                    ((VentanaInternaImagen)vi).lienzo1().setImage(imgdest);
                    ((VentanaInternaImagen)vi).lienzo1().repaint();
                }  
            }catch(Exception ex){
                System.err.println("No se pudo iluminar la imagen ");
            }
        }
    }//GEN-LAST:event_iluminacionActionPerformed

    private void oscurecerActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_oscurecerActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi != null) {
            try{
                BufferedImage imgSource = vi.getImagen();
                if(imgSource!=null){
                    LookupTable lt;
                    lt=LookupTableProducer.createLookupTable(LookupTableProducer.TYPE_POWER);
                    LookupOp lop = new LookupOp(lt, null);
                    BufferedImage imgdest = lop.filter(imgSource, null);
                    ((VentanaInternaImagen)vi).lienzo1().setImage(imgdest);
                    ((VentanaInternaImagen)vi).lienzo1().repaint();
                } 
            }catch(Exception ex){
                System.err.println("No se pudo oscurecer la imagen ");
            }
        }
    }//GEN-LAST:event_oscurecerActionPerformed

    private void senoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_senoActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi != null) {
            try{
                BufferedImage imgSource = vi.getImagen();
                if(imgSource!=null){
                    LookupTable lt;
                    lt = this.util.seno(180.0F/255.0F);
                    LookupOp lop = new LookupOp(lt, null);
                    BufferedImage imgdest = lop.filter(imgSource, imgSource);
                    ((VentanaInternaImagen)vi).lienzo1().setImage(imgdest);
                    ((VentanaInternaImagen)vi).lienzo1().repaint();
                } 
            }catch(Exception ex){
                System.err.println("No se pudo generar la funcion seno de la imagen ");
            }
        }
    }//GEN-LAST:event_senoActionPerformed

    private void rotacion90ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_rotacion90ActionPerformed
       rotation(90);
    }//GEN-LAST:event_rotacion90ActionPerformed

    private void rotacion180ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_rotacion180ActionPerformed
        rotation(180);
    }//GEN-LAST:event_rotacion180ActionPerformed

    private void rotacion270ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_rotacion270ActionPerformed
        rotation(270);
    }//GEN-LAST:event_rotacion270ActionPerformed
    private void rotation(int roto){
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi != null) {
            try{
                BufferedImage imgSource = vi.getImagen();
                if(imgSource!=null){
                    ((VentanaInternaImagen)vi).lienzo1().setImage(util.rotation(roto, imgSource));
                    ((VentanaInternaImagen)vi).lienzo1().repaint();
                }
            }catch(Exception ex){
                System.err.println("No se pudo rotar la imagen ");
            }
        }
    }
    private void nuevo_docActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_nuevo_docActionPerformed
        nuevoActionPerformed(evt);
    }//GEN-LAST:event_nuevo_docActionPerformed

    private void abrir_docActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_abrir_docActionPerformed
        abrirActionPerformed(evt);
    }//GEN-LAST:event_abrir_docActionPerformed

    private void guardar_docActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_guardar_docActionPerformed
        guardarActionPerformed(evt);
    }//GEN-LAST:event_guardar_docActionPerformed

    private void moverActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_moverActionPerformed
       if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
        ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setEditar(true);        
        mover.setSelected(true);
        etiqueta_barra_menu.setText("Editar");
        curva.setSelected(false);
        trazoLibre.setSelected(false);
        areaLuna.setSelected(false);
        linea.setSelected(false);
        rectangulo.setSelected(false);
        ovalo.setSelected(false);
      }
    }//GEN-LAST:event_moverActionPerformed

    private void rellenoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_rellenoActionPerformed
      if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){ 
        if (this.relleno.isSelected()){
            ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setBoolRelleno(true);
        }else{
            ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setBoolRelleno(false);
        }
      }
    }//GEN-LAST:event_rellenoActionPerformed

    private void transparenciaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_transparenciaActionPerformed
       if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){ 
        if (this.transparencia.isSelected()){
            ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setComposicion(true);
        }else{
            ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setComposicion(false);
        }
      }
    }//GEN-LAST:event_transparenciaActionPerformed

    private void alisarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_alisarActionPerformed
      if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
        if (this.alisar.isSelected()){
            ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setRender(true);
        }else{
            ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setRender(false);
        }
      }
    }//GEN-LAST:event_alisarActionPerformed

    private void coloresTrazoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_coloresTrazoActionPerformed
        if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
            switch(this.coloresTrazo.getSelectedIndex()){
                case 0: // negro
                    ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setColorContorno(Color.black);
                    break; 
                case 1: // rojo
                    ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setColorContorno(Color.red);
                    break;    
                case 2: // azul
                    ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setColorContorno(Color.blue);
                    break; 
                case 3: // blanco
                    ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setColorContorno(Color.white);
                    break;                     
                case 4: // amarillo
                    ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setColorContorno(Color.yellow);
                    break; 
                case 5: // verde
                    ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setColorContorno(Color.green);
                    break;                     
            }                   
        }
    }//GEN-LAST:event_coloresTrazoActionPerformed

    private void duplicarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_duplicarActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM)(this.jDesktopPane1.getSelectedFrame());
        if(vi!=null){
            if(vi.getImagen()!=null){
              try{
                ColorModel cm = vi.getImagen().getColorModel(); //clonar
                WritableRaster raster = vi.getImagen().copyData(null);//clonar cre un raster copia del anterior
                boolean alfaPre = vi.getImagen().isAlphaPremultiplied(); //clonar
                BufferedImage img  = new BufferedImage(cm,raster,alfaPre,null);

                this.v_interna = new VentanaInternaImagen(" duplicado ", this);
                jDesktopPane1.add(v_interna);
                v_interna.lienzo1().setImage(img);

                v_interna.setVisible(true);
                v_interna.setBounds(20, 20, img.getWidth()+30, img.getHeight()+40);
              }catch(Exception ex){
                System.err.println("No se pudo duplicar la imagen  ");
              }
            }
        }
    }//GEN-LAST:event_duplicarActionPerformed
    
    private void extraccion_bandasActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_extraccion_bandasActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi != null) {
            BufferedImage imgSource = vi.getImagen();
            if(imgSource!=null){
                try{
                    int numero_bandas = imgSource.getColorModel().getNumColorComponents();
                    for(int i = 0 ; i < numero_bandas ; i++){
                        String nombre = vi.getTitle() + " " + imgSource.getColorModel().getColorSpace().getName(i) ;
                        this.v_interna = new VentanaInternaImagen(nombre, this);
                        jDesktopPane1.add(v_interna);
                        BufferedImage img =  util.getBanda(i,imgSource);
                        v_interna.lienzo1().setImage(img);

                        v_interna.setVisible(true);
                        v_interna.setBounds(20, 20, img.getWidth()+30, img.getHeight()+40);
                    }
                } catch (Exception e) {
                    System.err.println( "No se pudo realizar la extraccion de bandas ");
                }
            }
        }
    }//GEN-LAST:event_extraccion_bandasActionPerformed
    
    private void sepiaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_sepiaActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi != null) {
            BufferedImage imgSource = vi.getImagen();
            if (imgSource != null) {
                try {
                    SepiaOp sepi = new SepiaOp();
                    sepi.filter(imgSource, imgSource);
                    
                    ((VentanaInternaImagen)vi).lienzo1().setImage(imgSource);
                    ((VentanaInternaImagen)vi).lienzo1().repaint();
                } catch (Exception e) {
                    System.err.println( "No se pudo realizar la operación Sepia ");
                }
            }
        }
    }//GEN-LAST:event_sepiaActionPerformed

    private void band_conbine_OpActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_band_conbine_OpActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi != null) {
            BufferedImage imgSource = vi.getImagen(); 
            if(imgSource!=null){
                try{
                    float [][] m = {{1.0F,0.0F,0.0F},{0.0F,0.0F,1.0F},{0.0F,1.0F,0.0F}};
                    BandCombineOp bcop = new BandCombineOp( m , null );
                    WritableRaster rasterdest = bcop.filter(imgSource.getRaster(),null);
                    BufferedImage imgdest = new BufferedImage(imgSource.getColorModel(),rasterdest,false,null);         
                    ((VentanaInternaImagen)vi).lienzo1().setImage(imgdest);
                    ((VentanaInternaImagen)vi).lienzo1().repaint();
                } catch (Exception e) {
                    System.err.println( "No se pudo realizar la operación  ");
                }
            }   
        }
    }//GEN-LAST:event_band_conbine_OpActionPerformed

    private void color_convert_opActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_color_convert_opActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi != null) {
            try{
                BufferedImage imgSource = vi.getImagen();
                if(imgSource!=null){            
                ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);
                ColorConvertOp ccop = new ColorConvertOp(cs,null);
                BufferedImage imgdest = ccop.filter(imgSource,null);
                ((VentanaInternaImagen)vi).lienzo1().setImage(imgdest);
                ((VentanaInternaImagen)vi).lienzo1().repaint();
                }
            } catch (Exception e) {
                System.err.println( "No se pudo realizar la operación  ");
            }
        }
        
    }//GEN-LAST:event_color_convert_opActionPerformed

    private void espacios_de_colorActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_espacios_de_colorActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi.getImagen() != null) {
          try{  
            BufferedImage imgSource = vi.getImagen();
            ColorSpace cs = ColorSpace.getInstance(ColorSpace.CS_LINEAR_RGB);
            
            switch(this.espacios_de_color.getSelectedIndex()){
                case 0: // RGB
                    cs = ColorSpace.getInstance(ColorSpace.CS_sRGB);
                    break;
                case 1: // YCC 
                    cs = ColorSpace.getInstance(ColorSpace.CS_PYCC);
                    break;
                case 2: // GREY
                    cs = ColorSpace.getInstance(ColorSpace.CS_GRAY);
                    break;
            }
        
            ColorConvertOp ccop = new ColorConvertOp(cs,null);
            BufferedImage imgdest = ccop.filter(imgSource,null);
            if(imgSource!=null){          
                ((VentanaInternaImagen)vi).lienzo1().setImage(imgdest);
                ((VentanaInternaImagen)vi).lienzo1().repaint();
            } 
          } catch (Exception e) {
              System.err.println( "No se pudo realizar la operación cambiar el espacio de color ");
          }
        }
    }//GEN-LAST:event_espacios_de_colorActionPerformed

    private void NegativoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_NegativoActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi.getImagen() != null) {
          try{
            BufferedImage imgSource = vi.getImagen();
            LookupTable lt;
            lt=LookupTableProducer.createLookupTable(LookupTableProducer.TYPE_NEGATIVE);
            LookupOp lop = new LookupOp(lt, null);
            BufferedImage imgdest = lop.filter(imgSource, imgSource);
            if(imgSource!=null){
                ((VentanaInternaImagen)vi).lienzo1().setImage(imgdest);
                ((VentanaInternaImagen)vi).lienzo1().repaint();
            }
           } catch (Exception e) {
              System.err.println( "No se pudo realizar la operación negativo ");
           }   
        }
    }//GEN-LAST:event_NegativoActionPerformed

    private void propiappActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_propiappActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi != null) {
            BufferedImage imgSource = vi.getImagen();
            if (imgSource != null) {
                try {
                    PropioPP prop = new PropioPP();
                    prop.filter(imgSource, imgSource);
                    ((VentanaInternaImagen)vi).lienzo1().setImage(imgSource);
                    ((VentanaInternaImagen)vi).lienzo1().repaint();
                } catch (Exception e) {
                    System.err.println( "No se pudo realizar la operación Propia ");
                }
            }
        }
    }//GEN-LAST:event_propiappActionPerformed

    private void tintadoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_tintadoActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi != null) {
            BufferedImage imgSource = vi.getImagen();
            if (imgSource != null) {
                try {
                    TintOp tintado = new TintOp(Color.red,0.5f);
                    BufferedImage imgdest=null;
                    if(imgSource.getColorModel().hasAlpha()){ 
                        imgdest = util.filterColor(imgSource, null,Color.red);
                    }else{
                         imgdest = tintado.filter(imgSource, imgSource);
                    }
                    if(vi.getImagen()!=null){
                        ((VentanaInternaImagen)vi).lienzo1().setImage(imgdest);
                        ((VentanaInternaImagen)vi).lienzo1().repaint();
                    }
                } catch (Exception e) {
                    System.err.println( "No se pudo realizar la operación Tintado " +e);
                }
            }
        }
    }//GEN-LAST:event_tintadoActionPerformed

    private void ecualizadorActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_ecualizadorActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi != null) {
            BufferedImage imgSource = vi.getImagen();
            if (imgSource != null) {
                try {
                    EqualizationOp ecualizacion = new EqualizationOp();
                    ecualizacion.filter(imgSource, imgSource);
                    if(vi.getImagen()!=null){
                        ((VentanaInternaImagen)vi).lienzo1().setImage(imgSource);
                        ((VentanaInternaImagen)vi).lienzo1().repaint();
                    }
                } catch (Exception e) {
                    System.err.println( "No se pudo realizar la operación ecualizar ");
                }
            }
        }
    }//GEN-LAST:event_ecualizadorActionPerformed

    private void binarizaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_binarizaActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi.getImagen() != null) {
          try{
            BufferedImage imgSource = vi.getImagen();
            LookupTable lt;
            lt=MlookupOp.createLookupTableBinariza();
            LookupOp lop = new LookupOp(lt, null);
            BufferedImage imgdest = lop.filter(imgSource, imgSource);
            if(vi.getImagen()!=null){
                ((VentanaInternaImagen)vi).lienzo1().setImage(imgdest);
                ((VentanaInternaImagen)vi).lienzo1().repaint();
            }
           } catch (Exception e) {
                System.err.println( "No se pudo realizar la operación binarizacion ");
           }     
        }
    }//GEN-LAST:event_binarizaActionPerformed

    private void posterizaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_posterizaActionPerformed
         VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi.getImagen() != null) {
           try{ 
            BufferedImage imgSource = vi.getImagen();
            LookupTable lt;
            lt=MlookupOp.createLookupTablePosteriza();
            LookupOp lop = new LookupOp(lt, null);
            BufferedImage imgdest = lop.filter(imgSource, imgSource);
            if(vi.getImagen()!=null){
                ((VentanaInternaImagen)vi).lienzo1().setImage(imgdest);
                ((VentanaInternaImagen)vi).lienzo1().repaint();
            }   
           } catch (Exception e) {
                System.err.println( "No se pudo realizar la operación posterizar ");
           }
        }
    }//GEN-LAST:event_posterizaActionPerformed

    private void propioccActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_propioccActionPerformed
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi != null) {
            BufferedImage imgSource = vi.getImagen();
            if (imgSource != null) {
                try {
                    PropioCC prop = new PropioCC();
                    prop.filter(imgSource, imgSource);
                    if(vi.getImagen()!=null){
                        ((VentanaInternaImagen)vi).lienzo1().setImage(imgSource);
                        ((VentanaInternaImagen)vi).lienzo1().repaint();
                    }
                } catch (Exception e) {
                    System.err.println( "No se pudo realizar la operación Propia ");
                }
            }
        }
    }//GEN-LAST:event_propioccActionPerformed

    private void Slider_umbralizacionStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_Slider_umbralizacionStateChanged
        VentanaInternaSM vi = (VentanaInternaSM) (this.jDesktopPane1.getSelectedFrame());
        if (vi.getImagen() != null) {
            if (imgSourc != null) {
                try {
                    UmbralizacionOp umbral = new UmbralizacionOp(this.Slider_umbralizacion.getValue()); 
                    BufferedImage img = umbral.filter(imgSourc, null);
                    if(vi.getImagen()!=null){
                    ((VentanaInternaImagen)vi).lienzo1().setImage(img);
                    ((VentanaInternaImagen)vi).lienzo1().repaint();
                    }
                } catch (Exception e) {
                    System.err.println( "No se pudo realizar la operación Umbralización ");
                }
            }
        }
    }//GEN-LAST:event_Slider_umbralizacionStateChanged

    private void Slider_umbralizacionFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_Slider_umbralizacionFocusGained
        VentanaInternaSM vi = (VentanaInternaSM)(this.jDesktopPane1.getSelectedFrame());
        if(vi.getImagen()!=null){
            ColorModel cm = vi.getImagen().getColorModel(); //clonar
            WritableRaster raster = vi.getImagen().copyData(null);//clonar cre un raster copia del anterior
            boolean alfaPre = vi.getImagen().isAlphaPremultiplied(); //clonar
            imgSourc = new BufferedImage(cm,raster,alfaPre,null);
        }
    }//GEN-LAST:event_Slider_umbralizacionFocusGained

    private void Slider_umbralizacionFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_Slider_umbralizacionFocusLost
        imgSourc = null;
        this.slider_rotacion.setValue(0);
    }//GEN-LAST:event_Slider_umbralizacionFocusLost

    private void grabarSonidoBarrHerramActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_grabarSonidoBarrHerramActionPerformed
        if(this.grabarSonidoBarrHerram.isSelected()){ 
            JFileChooser dlg = new JFileChooser();
            int resp = dlg.showOpenDialog(this);
            if( resp == JFileChooser.APPROVE_OPTION) {
                f = dlg.getSelectedFile();
                    recorder =  new SMSoundRecorder(f);
                    recorder.record();
                    
                    contad = true ;
                    Thread t = new Thread(){//www.youtube.com/watch?v=LoKQvAQpL3w
                        @Override
                        public void run(){
                            for(;;){
                                if(contad == true){
                                    try{
                                        if(segundos>59){
                                            segundos=0;
                                            minutos ++ ;
                                        }
                                        sleep(1000);
                                        if(segundos<10 && minutos<10){
                                            contador.setText("0"+minutos+":0"+segundos);
                                        }else if(segundos<10){
                                            contador.setText(minutos+":0"+segundos);
                                        }else if(minutos<10){
                                            contador.setText("0"+minutos+":"+segundos);
                                        }else{
                                            contador.setText(minutos+":"+segundos);
                                        }
                                        segundos++;
                                    }catch(Exception e){
                                        System.err.println(e);
                                    }
                                }else{
                                    break;
                                }
                            }
                        }
                    };
                    t.start();
                }
            }else{
                contad = false;
                segundos=minutos=0;
                contador.setText("00:00");
                if(recorder!=null){
                    recorder.stop();
                

                    File nf = new File( f.getAbsolutePath() ){
                        @Override
                        public String toString(){
                            return this.getName();
                        }
                    };
                    this.listaReproduccion.addItem(nf);
                    this.listaReproduccion.setSelectedItem(nf);
                }
            }
    }//GEN-LAST:event_grabarSonidoBarrHerramActionPerformed

    private void grabaAudioActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_grabaAudioActionPerformed
        grabarSonidoBarrHerramActionPerformed(evt);           
    }//GEN-LAST:event_grabaAudioActionPerformed

    private void playSonidoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_playSonidoActionPerformed
         File f = (File)listaReproduccion.getSelectedItem();
        
        if(f!=null){
            player =  new SMClipPlayer(f);
            if (player != null) {
                player.addLineListener(new ManejadorAudio());
                player.play();
                contad = true;
                Thread t = new Thread(){//www.youtube.com/watch?v=LoKQvAQpL3w
                        @Override
                        public void run(){
                            for(;;){
                                if(contad == true){
                                    try{
                                        if(segundos>59){
                                            segundos=0;
                                            minutos ++ ;
                                        }
                                        sleep(1000);
                                        if(segundos<10 && minutos<10){
                                            contador.setText("0"+minutos+":0"+segundos);
                                        }else if(segundos<10){
                                            contador.setText(minutos+":0"+segundos);
                                        }else if(minutos<10){
                                            contador.setText("0"+minutos+":"+segundos);
                                        }else{
                                            contador.setText(minutos+":"+segundos);
                                        }
                                        segundos++;
                                    }catch(Exception e){
                                        System.err.println(e);
                                    }
                                }else{
                                    break;
                                }
                            }
                        }
                    };
                    t.start();
            }
        }
    }//GEN-LAST:event_playSonidoActionPerformed

    private void stopSonidoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_stopSonidoActionPerformed
        if(player!=null){
            player.addLineListener(new ManejadorAudio());
            player.stop();
            contad = false;
            segundos=minutos=0;
        }
    }//GEN-LAST:event_stopSonidoActionPerformed

    private void curvaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_curvaActionPerformed
      if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
        ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setDibujo(Dibujo.enum_curva);
        etiqueta_barra_menu.setText("Curva");
        curva.setSelected(true);
        areaLuna.setSelected(false);
        trazoLibre.setSelected(false);
        linea.setSelected(false);
        rectangulo.setSelected(false);
        ovalo.setSelected(false);
        mover.setSelected(false);
        ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setEditar(false);
      }
    }//GEN-LAST:event_curvaActionPerformed

    private void trazoLibreActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_trazoLibreActionPerformed
      if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
        ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setDibujo(Dibujo.enum_trazoLibre);
        etiqueta_barra_menu.setText("Trazo libre");
        trazoLibre.setSelected(true);
        areaLuna.setSelected(false);
        curva.setSelected(false);
        linea.setSelected(false);
        rectangulo.setSelected(false);
        ovalo.setSelected(false);
        mover.setSelected(false);
        ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setEditar(false);
      }
    }//GEN-LAST:event_trazoLibreActionPerformed

    private void areaLunaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_areaLunaActionPerformed
      if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
        ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setDibujo(Dibujo.enum_propio);
        etiqueta_barra_menu.setText("Propio");
        areaLuna.setSelected(true);
        trazoLibre.setSelected(false);
        curva.setSelected(false);
        linea.setSelected(false);
        rectangulo.setSelected(false);
        ovalo.setSelected(false);
        mover.setSelected(false);
        ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setEditar(false);
      }
    }//GEN-LAST:event_areaLunaActionPerformed

    private void gradoTransparenciaStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_gradoTransparenciaStateChanged
       if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
        if (this.transparencia.isSelected()){//int
            ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().gradoTransparencia(gradoTransparencia.getValue());
        }else{
            ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().gradoTransparencia(100);
        }
       }
    }//GEN-LAST:event_gradoTransparenciaStateChanged

    private void discontinuidadActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_discontinuidadActionPerformed
        if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
            switch(this.discontinuidad.getSelectedIndex()){
                case 0: // punteada traza a tope
                    ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setDiscontinuidad( BasicStroke.CAP_BUTT);
                    break; 
                case 1: // punteada traza redonda
                    ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setDiscontinuidad(BasicStroke.CAP_ROUND);
                    break;    
                case 2: // punteada traza cuadrada
                    ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setDiscontinuidad(BasicStroke.CAP_SQUARE);
                    break; 
                case 3: // continua
                    ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setDiscontinuidad(3);
                    break;                       
            } 
        }  
    }//GEN-LAST:event_discontinuidadActionPerformed

    private void SliderPatronDiscontinuidadStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_SliderPatronDiscontinuidadStateChanged
      if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
        if(this.discontinuidad.getSelectedIndex()!=3){
            ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setPatronDiscontinuidad(this.SliderPatronDiscontinuidad.getValue());
        }
      }
    }//GEN-LAST:event_SliderPatronDiscontinuidadStateChanged

    private void camaraActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_camaraActionPerformed
        VentanaInternaSM vi  =  ventanaInternaCamara.getInstance();
        this.jDesktopPane1.add(vi);
        vi.setVisible(true);
    }//GEN-LAST:event_camaraActionPerformed

    private void capturaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_capturaActionPerformed
        VentanaInternaSM captura = (VentanaInternaSM)(this.jDesktopPane1.getSelectedFrame());
        if(captura!=null){
            BufferedImage img = null;
            if(captura instanceof ventanaInternaCamara){
                img = ((ventanaInternaCamara)captura).getShot();
            }else if (captura instanceof VentanaInternaJMFPlayer){
               img = ((VentanaInternaJMFPlayer)captura).getShot();
            }
            if(img!=null){
                VentanaInternaImagen vi = new VentanaInternaImagen("Nuevo imagen", this);
                vi.lienzo1().setImage((BufferedImage)img);
                this.jDesktopPane1.add(vi);
                vi.setTitle("captura nueva imagen");
                vi.setVisible(true);
                vi.setBounds(20, 20, img.getWidth()+30, img.getHeight()+40);
            }
        }
    }//GEN-LAST:event_capturaActionPerformed

    private void coloresRellenoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_coloresRellenoActionPerformed
        if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
            switch(this.coloresRelleno.getSelectedIndex()){
                case 0: // negro
                    ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setColorRelleno(Color.black);
                    break; 
                case 1: // rojo
                    ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setColorRelleno(Color.red);
                    break;    
                case 2: // azul
                    ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setColorRelleno(Color.blue);
                    break; 
                case 3: // blanco
                    ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setColorRelleno(Color.white);
                    break;                     
                case 4: // amarillo
                    ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setColorRelleno(Color.yellow);
                    break; 
                case 5: // verde
                    ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setColorRelleno(Color.green);
                    break;                     
            }
          }
    }//GEN-LAST:event_coloresRellenoActionPerformed

    private void colorContornoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_colorContornoActionPerformed
       if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
           Color c = JColorChooser.showDialog (null, "Elegir un color" , getForeground ());
            if (c != null){
                ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setColorContorno(c);
                coloresTrazo.setSelectedItem(c);
            }
        }
    }//GEN-LAST:event_colorContornoActionPerformed

    private void colorRellenoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_colorRellenoActionPerformed
      if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
        Color c = JColorChooser.showDialog (null, "Elegir un color" , getForeground ());
        if (c != null){
            ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setColorRelleno(c);
            coloresRelleno.setSelectedItem(c);
        }
      }
    }//GEN-LAST:event_colorRellenoActionPerformed

    private void colorDegradadoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_colorDegradadoActionPerformed
      if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
        Color c = JColorChooser.showDialog (null, "Elegir un color" , getForeground ());
        if (c != null){
            ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setColorDegradado(c);
        }
      }
    }//GEN-LAST:event_colorDegradadoActionPerformed

    private void degradadoOpcionActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_degradadoOpcionActionPerformed
      if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
        switch(this.degradadoOpcion.getSelectedIndex()){
            case 0: // degradado Horizontal
                ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().opcionDegradado(0);
                break; 
            case 1: // Degradado Vertical
                ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().opcionDegradado(1);
                break;    
            case 2: // Degradado Inclinado
                ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().opcionDegradado(2);
                break; 
        }
      }
    }//GEN-LAST:event_degradadoOpcionActionPerformed

    private void degradadoActivarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_degradadoActivarActionPerformed
       if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
        if(this.degradadoActivar.isSelected()){
            ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().SetSiDegradado(true);
        }else{
            ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().SetSiDegradado(false);
        }
       }
    }//GEN-LAST:event_degradadoActivarActionPerformed

    private void taerFrenteActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_taerFrenteActionPerformed
      if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
        if(this.taerFrente.isSelected()){
           ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setTraerFrente(true);
           this.enviarAtras.setSelected(false);
           this.enviarFondo.setSelected(false);
           this.traerDelante.setSelected(false);
       }else{
           ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setTraerFrente(false);
       }
      }
    }//GEN-LAST:event_taerFrenteActionPerformed

    private void enviarFondoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_enviarFondoActionPerformed
       if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
            if(this.enviarFondo.isSelected()){
               ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setEnviarFondo(true);
               this.enviarAtras.setSelected(false);
               this.taerFrente.setSelected(false);
               this.traerDelante.setSelected(false);
           }else{
               ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setEnviarFondo(false);
           }
        }
    }//GEN-LAST:event_enviarFondoActionPerformed

    private void enviarAtrasActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_enviarAtrasActionPerformed
      if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
        if(this.enviarAtras.isSelected()){
           ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setEnviarAtras(true);
           this.taerFrente.setSelected(false);
           this.enviarFondo.setSelected(false);
           this.traerDelante.setSelected(false);
       }else{
           ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setEnviarAtras(false);
       }
      }
    }//GEN-LAST:event_enviarAtrasActionPerformed

    private void traerDelanteActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_traerDelanteActionPerformed
      if(this.jDesktopPane1.getSelectedFrame() instanceof VentanaInternaImagen){
        if(this.traerDelante.isSelected()){
           ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setTraerDelante(true);
           this.enviarAtras.setSelected(false);
           this.enviarFondo.setSelected(false);
           this.taerFrente.setSelected(false);
       }else{
           ((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().setTraerDelante(false);
       }
      }
    }//GEN-LAST:event_traerDelanteActionPerformed

    private void ayudaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_ayudaActionPerformed
        JOptionPane.showMessageDialog(this, " Nombre del programa : Multimedia\n Version: 2.0 \n Autor: Matilde Cabrera González ");
    }//GEN-LAST:event_ayudaActionPerformed

    /**
     * Muestra la etiqueta de la barra de menu.
     * @param text, string, mensaje mostrado en la etiqueta barra de menu.
     */
    public void setEtiqueta_barra_menu(String text){
        etiqueta_barra_menu.setText(text);
    }
    
    /**
     * Refresca el estado de los botones de las figuras pintadas cuando son seleccionadas, y de los nuevos lienzos.
     * @param dibujo, El tipo de figura que pintamos o seleccionamos.
     * @param mifigura, Los atributos de la figura pintada.
     * @param contorno, El contorno que hay en lienzo, los atributos que componen el contorno.
     * @param relleno, El relleno que hay en lienzo, los atributos que componen el relleno.
     */
    public void setMiVentana(Dibujo dibujo,MFiguras mifigura,MContorno contorno,MRelleno relleno){
        ActionEvent evt = null;
        this.mover.setSelected(((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().getEditar());
        if(!((VentanaInternaImagen) this.jDesktopPane1.getSelectedFrame()).lienzo1().getEditar()){
            if(dibujo==Dibujo.enum_linea){
                lineaActionPerformed(evt);
            }else if(dibujo==Dibujo.enum_rectangulo){
                rectanguloActionPerformed(evt);
            }else if(dibujo == Dibujo.enum_elipse){
                ovaloActionPerformed(evt);
            }else if(dibujo==Dibujo.enum_curva){
                this.curvaActionPerformed(evt);
            }else if(dibujo==Dibujo.enum_trazoLibre){
                this.trazoLibreActionPerformed(evt);
            }else if(dibujo == Dibujo.enum_propio){
                this.areaLunaActionPerformed(evt);
            }
            activarPropiedadesContorno(contorno);
            activarPropiedadesRelleno(relleno);
        }else{
            activarPropiedadesContorno(mifigura.getContorno());
            activarPropiedadesRelleno(mifigura.getRelleno());
        } 
    }
    
    /**
     *  Metodo privado que activa las propiedades de las figuras con contorno.
     * @param cont, El contorno de la figura seleccinada.
     */
    private void activarPropiedadesContorno(MContorno cont){
        this.grosor.setValue(cont.getGrosor());
        this.alisar.setSelected(cont.getRender());
        this.coloresTrazo.setSelectedItem(cont.getColorContorno());
        this.transparencia.setSelected(cont.getCompo());
        if(cont.getCompo()){
            gradoTransparencia.setValue((int)(cont.getGradoTransparencia()*100));
        }
        this.discontinuidad.setSelectedIndex(cont.getDiscontinuidad());
        if(discontinuidad.getSelectedIndex()!=3){ // 3 representa la linea continua
            SliderPatronDiscontinuidad.setValue(cont.getPatronDiscontinuidad());
        }
    }
    /**
     * Metodo privado que activa las propiedades de las figuras con relleno.
     * @param mifigura, El relleno de la figura seleccionada.
     */
    private void activarPropiedadesRelleno(MRelleno mifigura){
        this.relleno.setSelected(mifigura.getBoolRelleno());
        //if(mifigura.getBoolRelleno()){
            this.coloresRelleno.setSelectedItem(mifigura.getColorRelleno());
        //}
        this.degradadoActivar.setSelected(mifigura.getSiDegradado());
        //if(mifigura.getSiDegradado()){
            this.degradadoOpcion.setSelectedIndex(mifigura.getOptionDegradado());
        //}
    }
    
    /**
     * Clase interna que maneja el audio de la aplicación.
     */
    public class ManejadorAudio implements LineListener{

        @Override
        public void update(LineEvent event) {
            if (event.getType() == LineEvent.Type.START) {
                playSonido.setEnabled(false);
            }
            if (event.getType() == LineEvent.Type.STOP) {
                playSonido.setEnabled(true);
            }
            if (event.getType() == LineEvent.Type.CLOSE) {
            }
        }
    
    }
    
    /**
     * Clase interna que maneja la grabacion de audio de la aplicación.
     */
    public class ManejadorAudioGrabar implements LineListener{

        @Override
        public void update(LineEvent event) {
            if (event.getType() == LineEvent.Type.START) {
                grabarSonidoBarrHerram.setEnabled(false);
            }
            if (event.getType() == LineEvent.Type.STOP) {
                grabarSonidoBarrHerram.setEnabled(true);
            }
            if (event.getType() == LineEvent.Type.CLOSE) {
            }
        }
    
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JComboBox<String> Filtros;
    private javax.swing.JButton Negativo;
    private javax.swing.JSlider SliderPatronDiscontinuidad;
    private javax.swing.JSlider Slider_umbralizacion;
    private javax.swing.JMenuItem abrir;
    private javax.swing.JButton abrir_doc;
    private javax.swing.JMenuItem affine_transfor_Op;
    private javax.swing.JToggleButton alisar;
    private javax.swing.JMenu archivo;
    private javax.swing.JToggleButton areaLuna;
    private javax.swing.JButton aumentar_Escala;
    private javax.swing.JMenuItem ayuda;
    private javax.swing.JMenuItem band_conbine_Op;
    private javax.swing.JToolBar barraHerramientasSuperior;
    private javax.swing.JCheckBoxMenuItem barra_atributos;
    private javax.swing.JCheckBoxMenuItem barra_estado;
    private javax.swing.JCheckBoxMenuItem barra_formas;
    private javax.swing.JButton binariza;
    private javax.swing.JButton camara;
    private javax.swing.JButton captura;
    private javax.swing.JButton colorContorno;
    private javax.swing.JButton colorDegradado;
    private javax.swing.JButton colorRelleno;
    private javax.swing.JMenuItem color_convert_op;
    private javax.swing.JComboBox<Color> coloresRelleno;
    private javax.swing.JComboBox<Color> coloresTrazo;
    private javax.swing.JLabel contador;
    private javax.swing.JButton contraste;
    private javax.swing.JMenuItem convolveOP;
    private javax.swing.JToggleButton curva;
    private javax.swing.JToggleButton degradadoActivar;
    private javax.swing.JComboBox<String> degradadoOpcion;
    private javax.swing.JSlider deslizador_brillo;
    private javax.swing.JComboBox<String> discontinuidad;
    private javax.swing.JButton disminuir_Escala;
    private javax.swing.JMenuItem duplicar;
    private javax.swing.JButton ecualizador;
    private javax.swing.JMenu edicion;
    private javax.swing.JToggleButton enviarAtras;
    private javax.swing.JToggleButton enviarFondo;
    private javax.swing.JComboBox<String> espacios_de_color;
    private javax.swing.JLabel etiqueta_barra_menu;
    private javax.swing.JButton extraccion_bandas;
    private javax.swing.JMenuItem grabaAudio;
    private javax.swing.JToggleButton grabarSonidoBarrHerram;
    private javax.swing.JSlider gradoTransparencia;
    private javax.swing.JSpinner grosor;
    private javax.swing.JMenuItem guardar;
    private javax.swing.JButton guardar_doc;
    private javax.swing.JButton iluminacion;
    private javax.swing.JMenu imagen;
    private javax.swing.JDesktopPane jDesktopPane1;
    private javax.swing.JMenuBar jMenuBar1;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel10;
    private javax.swing.JPanel jPanel11;
    private javax.swing.JPanel jPanel12;
    private javax.swing.JPanel jPanel13;
    private javax.swing.JPanel jPanel14;
    private javax.swing.JPanel jPanel15;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JPanel jPanel7;
    private javax.swing.JPanel jPanel9;
    private javax.swing.JToolBar jToolBar3;
    private javax.swing.JToolBar jToolBar4;
    private javax.swing.JToolBar jToolBar5;
    private javax.swing.JToggleButton linea;
    private javax.swing.JComboBox<File> listaReproduccion;
    private javax.swing.JMenuItem lookup_Op;
    private javax.swing.JToggleButton mover;
    private javax.swing.JMenuItem nuevo;
    private javax.swing.JButton nuevo_doc;
    private javax.swing.JButton oscurecer;
    private javax.swing.JToggleButton ovalo;
    private javax.swing.JButton playSonido;
    private javax.swing.JButton posteriza;
    private javax.swing.JButton propiapp;
    private javax.swing.JButton propiocc;
    private javax.swing.JToggleButton rectangulo;
    private javax.swing.JToggleButton relleno;
    private javax.swing.JMenuItem resacaleOP;
    private javax.swing.JButton rotacion180;
    private javax.swing.JButton rotacion270;
    private javax.swing.JButton rotacion90;
    private javax.swing.JButton seno;
    private javax.swing.JButton sepia;
    private javax.swing.JSlider slider_rotacion;
    private javax.swing.JButton stopSonido;
    private javax.swing.JToggleButton taerFrente;
    private javax.swing.JButton tintado;
    private javax.swing.JToggleButton traerDelante;
    private javax.swing.JToggleButton transparencia;
    private javax.swing.JToggleButton trazoLibre;
    // End of variables declaration//GEN-END:variables
    private practicafinalsmm.VentanaInternaImagen externa;
    private practicafinalsmm.VentanaInternaImagen v_interna;
    private BufferedImage imgSourc;
    private utilities util;
    SMClipPlayer player = null;
    SMSoundRecorder recorder = null;
    FrameGrabbingControl payercaptura;
    File f = null ;
    private boolean contad=true;
    static int segundos = 0;
    static int minutos = 0;
}